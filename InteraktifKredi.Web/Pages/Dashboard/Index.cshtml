@page
@model InteraktifKredi.Web.Pages.Dashboard.IndexModel
@{
    ViewData["Title"] = "Ana MenÃ¼";
    Layout = "_DashboardLayout";
}

<!-- KVKK Modal KontrolÃ¼ - Layout dÄ±ÅŸÄ±nda -->
@if (Model.ShowKvkk)
{
    <!-- KVKK Modal (Full screen overlay) -->
    <script>
        // Global fonksiyon - inline onclick iÃ§in
        function approveKvkk() {
            var $btn = $('#btn-approve-kvkk');
            var kvkkId = @Model.KvkkId;
            var customerId = @Model.CustomerId;
            
            console.log('ğŸ”µ KVKK Onay butonu tÄ±klandÄ±', { kvkkId, customerId });
            
            $btn.prop('disabled', true).text('Kaydediliyor...');
            
            $.ajax({
                url: '/Dashboard/Index?handler=ApproveKvkk',
                type: 'POST',
                contentType: 'application/json',
                headers: {
                    'RequestVerificationToken': $('input[name="__RequestVerificationToken"]').val()
                },
                data: JSON.stringify({
                    kvkkId: kvkkId,
                    customerId: customerId
                }),
                success: function(response) {
                    console.log('âœ… KVKK onay response:', response);
                    
                    if (response && response.success === true) {
                        console.log('âœ… KVKK onaylandÄ±, modal kapatÄ±lÄ±yor...');
                        
                        // Modal'Ä± kapat
                        $('#kvkkModal').fadeOut(300, function() {
                            $(this).remove();
                        });
                        
                        // Blur'u kaldÄ±r
                        $('.dashboard_sidebar, .dashboard_main').css({
                            'filter': 'none',
                            'pointer-events': 'auto'
                        });
                        
                        console.log('âœ… Dashboard aktif!');
                    } else {
                        console.error('âŒ KVKK onayÄ± baÅŸarÄ±sÄ±z:', response);
                        alert('KVKK onayÄ± kaydedilemedi. LÃ¼tfen tekrar deneyin.');
                        $btn.prop('disabled', false).text('Okudum, OnaylÄ±yorum');
                    }
                },
                error: function(xhr, status, error) {
                    console.error('âŒ AJAX hatasÄ±:', { status, error, response: xhr.responseText });
                    alert('Bir hata oluÅŸtu. LÃ¼tfen sayfayÄ± yenileyip tekrar deneyin.');
                    $btn.prop('disabled', false).text('Okudum, OnaylÄ±yorum');
                }
            });
            
            return false; // Form submit'i engelle
        }
        
        // DOM hazÄ±r olunca blur uygula
        $(document).ready(function() {
            $('.dashboard_sidebar, .dashboard_main').css({
                'filter': 'blur(5px)',
                'pointer-events': 'none'
            });
            console.log('âœ… KVKK Modal aktif - Dashboard blur edildi');
        });
    </script>
    
    <!-- KVKK Modal HTML -->
    <div id="kvkkModal" class="modal-overlay active" style="position: fixed; z-index: 10000; top: 0; left: 0; width: 100%; height: 100%;">
        <div class="modal-container">
            <div class="modal-header">
                <h3>AydÄ±nlatma Metni</h3>
            </div>
            <div class="modal-body" id="kvkk-content">
                @Html.Raw(Model.KvkkTextContent ?? "Metin yÃ¼kleniyor...")
            </div>
            <div class="modal-footer">
                @Html.AntiForgeryToken()
                <button type="button" class="btn_primary" id="btn-approve-kvkk" onclick="approveKvkk(); return false;">
                    Okudum, OnaylÄ±yorum
                </button>
            </div>
        </div>
    </div>
}

<!-- ========================================================================
     ANA MENÃœ Ä°Ã‡ERÄ°ÄÄ° (Åimdilik boÅŸ)
======================================================================== -->

<div class="dashboard_page">
    <!-- Ana MenÃ¼ iÃ§eriÄŸi buraya eklenecek -->
</div>
