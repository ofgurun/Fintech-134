@page "/ReportDetail"
@model InteraktifKredi.Web.Pages.ReportDetailModel
@{
    ViewData["Title"] = "Rapor Detayı";
    Layout = "_DashboardLayout";
}

<style>
    /* ========================================================================
       REPORT DETAIL PAGE - PREMIUM FINANCIAL DASHBOARD
       ======================================================================== */
    
    /* Genel Stil */
    .report_detail {
        font-family: 'Inter', 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
        background-color: #F3F4F6;
        min-height: 100vh;
        padding: 2rem 1rem;
    }
    
    /* Container */
    .report_detail > * {
        max-width: 1200px;
        margin: 0 auto;
    }
    
    /* ========================================================================
       HEADER SECTION
       ======================================================================== */
    
    .report_detail__header {
        background-color: #FFFFFF;
        border-radius: 12px;
        padding: 1.5rem;
        margin-bottom: 2rem;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05), 0 10px 15px rgba(0, 0, 0, 0.08);
        border: 1px solid #E5E7EB;
    }
    
    .report_detail__header_content {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }
    
    .report_detail__back_btn {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem 0.75rem;
        margin-bottom: 1rem;
        color: #374151;
        text-decoration: none;
        font-size: 0.875rem;
        font-weight: 500;
        border-radius: 6px;
        transition: all 0.2s;
    }
    
    .report_detail__back_btn:hover {
        color: #2563EB;
        background-color: #EFF6FF;
    }
    
    .report_detail__title {
        font-size: 1.875rem;
        font-weight: 700;
        color: #111827;
        margin: 0 0 0.5rem 0;
        line-height: 1.2;
    }
    
    .report_detail__date {
        font-size: 1rem;
        color: #6B7280;
        margin: 0;
    }
    
    /* ========================================================================
       SUMMARY CARDS SECTION (3 Cards - Flexbox)
       ======================================================================== */
    
    .report_detail__summary_cards {
        display: flex;
        gap: 1.5rem;
        margin-bottom: 2rem;
        flex-wrap: wrap;
    }
    
    @@media (min-width: 768px) {
        .report_detail__summary_cards {
            flex-wrap: nowrap;
        }
    }
    
    /* Base Card Styles - Premium Shadows */
    .report_detail__summary_card {
        flex: 1;
        min-width: 250px;
        background-color: #FFFFFF;
        border-radius: 12px;
        padding: 1.5rem;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05), 0 10px 15px rgba(0, 0, 0, 0.08);
        border: 1px solid #E5E7EB;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .report_detail__summary_card:hover {
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1), 0 20px 40px rgba(0, 0, 0, 0.08);
        transform: translateY(-4px);
    }
    
    /* Hero Card (Kredi Notu) - Modern Gradient */
    .report_detail__summary_card--hero {
        background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
        border: none;
        color: #FFFFFF;
    }
    
    .report_detail__summary_card--hero:hover {
        box-shadow: 0 20px 25px rgba(30, 64, 175, 0.25), 0 10px 10px rgba(30, 64, 175, 0.15);
    }
    
    .report_detail__summary_card_content {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
    }
    
    /* Card Label */
    .report_detail__summary_card_label {
        font-size: 0.875rem;
        font-weight: 500;
        color: #6B7280;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    .report_detail__summary_card--hero .report_detail__summary_card_label {
        color: rgba(255, 255, 255, 0.9);
    }
    
    /* Hero Card Value - Çok Büyük */
    .report_detail__summary_card_value--hero {
        font-size: 3rem;
        font-weight: 700;
        line-height: 1;
        color: #FFFFFF;
        margin: 0.5rem 0;
    }
    
    @@media (max-width: 640px) {
        .report_detail__summary_card_value--hero {
            font-size: 2.5rem;
        }
    }
    
    /* Large Card Value (Limit ve Borç) */
    .report_detail__summary_card_value--large {
        font-size: 1.75rem;
        font-weight: 600;
        color: #111827;
        line-height: 1.2;
    }
    
    /* Progress Bar (Hero Card) */
    .report_detail__progress_bar {
        width: 100%;
        height: 8px;
        background-color: rgba(255, 255, 255, 0.25);
        border-radius: 9999px;
        margin: 1rem 0;
        overflow: hidden;
    }
    
    .report_detail__progress_bar_fill {
        width: 70%;
        height: 100%;
        background: linear-gradient(90deg, #FCD34D 0%, #10B981 100%);
        border-radius: 9999px;
        transition: width 0.6s ease-out;
        box-shadow: 0 2px 8px rgba(16, 185, 129, 0.4);
    }
    
    /* Hero Card Badge */
    .report_detail__summary_card_badge {
        display: inline-flex;
        align-items: center;
        padding: 0.25rem 1rem;
        border-radius: 9999px;
        font-size: 0.875rem;
        font-weight: 500;
        background-color: rgba(255, 255, 255, 0.2);
        color: #FFFFFF;
        margin-top: 0.5rem;
        align-self: flex-start;
    }
    
    /* Card Icon - Premium Styled */
    .report_detail__summary_card_icon {
        width: 56px;
        height: 56px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 14px;
        margin-bottom: 0.75rem;
    }
    
    /* Limit Card Icon - Açık Mavi */
    .report_detail__summary_card:nth-child(2) .report_detail__summary_card_icon {
        background-color: #EFF6FF;
        color: #2563EB;
    }
    
    /* Debt Card Icon - Açık Kırmızı */
    .report_detail__summary_card:nth-child(3) .report_detail__summary_card_icon {
        background-color: #FEE2E2;
        color: #DC2626;
    }
    
    .report_detail__summary_card_icon svg {
        width: 28px;
        height: 28px;
    }
    
    /* ========================================================================
       TABLE SECTION (Modern Data Table)
       ======================================================================== */
    
    .report_detail__table_wrapper {
        background-color: #FFFFFF;
        border-radius: 12px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05), 0 10px 15px rgba(0, 0, 0, 0.08);
        border: 1px solid #E5E7EB;
        margin-bottom: 2rem;
        overflow: hidden;
    }
    
    .report_detail__table_header_section {
        padding: 1.5rem;
        border-bottom: 1px solid #E5E7EB;
        background-color: #FFFFFF;
    }
    
    .report_detail__table_title {
        font-size: 1.25rem;
        font-weight: 600;
        color: #111827;
        margin: 0;
    }
    
    .report_detail__table_container {
        overflow-x: auto;
    }
    
    .report_detail__table {
        width: 100%;
        border-collapse: collapse;
        font-family: 'Inter', 'Segoe UI', sans-serif;
    }
    
    /* Table Header */
    .report_detail__table_head {
        background-color: #F9FAFB;
    }
    
    .report_detail__table_header {
        padding: 1rem 1.25rem;
        text-align: left;
        font-size: 0.75rem;
        font-weight: 600;
        color: #374151;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        white-space: nowrap;
    }
    
    .report_detail__table_header--right {
        text-align: right;
    }
    
    /* Table Body */
    .report_detail__table_row {
        border-bottom: 1px solid #E5E7EB;
    }
    
    .report_detail__table_row:last-child {
        border-bottom: none;
    }
    
    .report_detail__table_body .report_detail__table_row {
        transition: background-color 0.2s;
        background-color: #FFFFFF;
    }
    
    .report_detail__table_body .report_detail__table_row:hover {
        background-color: #F3F4F6;
    }
    
    .report_detail__table_cell {
        padding: 1.25rem 1.5rem;
        font-size: 0.875rem;
        color: #374151;
        vertical-align: middle;
    }
    
    /* Bank Name - Bold */
    .report_detail__table_cell--bank {
        font-weight: 600;
        color: #111827;
    }
    
    .report_detail__table_cell--numeric {
        text-align: right;
    }
    
    /* Numeric Values - Monospace Font */
    .report_detail__table_number {
        font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, monospace;
        font-variant-numeric: tabular-nums;
        font-weight: 600;
        color: #111827;
    }
    
    .report_detail__table_currency {
        font-size: 0.75rem;
        color: #6B7280;
        margin-left: 0.25rem;
        font-weight: 400;
    }
    
    /* Status Badge - Premium Monospace */
    .report_detail__table_badge {
        display: inline-block;
        padding: 0.375rem 0.875rem;
        border-radius: 6px;
        font-size: 0.75rem;
        font-weight: 500;
        background-color: #F3F4F6;
        color: #374151;
        font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
        border: 1px solid #E5E7EB;
        letter-spacing: 0.025em;
    }
    
    /* ========================================================================
       ACTIONS SECTION (Back Button)
       ======================================================================== */
    
    .report_detail__actions {
        display: flex;
        justify-content: flex-end;
        margin-top: 2.5rem;
        padding-top: 2rem;
    }
    
    @@media (max-width: 640px) {
        .report_detail__actions {
            justify-content: center;
        }
    }
    
    .report_detail__back_to_list_btn {
        padding: 0.75rem 1.5rem;
        font-size: 0.875rem;
        font-weight: 600;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        border-radius: 6px;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        background-color: #2563EB;
        color: #FFFFFF;
        box-shadow: 0 4px 6px rgba(37, 99, 235, 0.2), 0 2px 4px rgba(37, 99, 235, 0.1);
    }
    
    .report_detail__back_to_list_btn:hover {
        background-color: #1E40AF;
        transform: translateY(-2px);
        box-shadow: 0 10px 15px rgba(37, 99, 235, 0.3), 0 4px 6px rgba(37, 99, 235, 0.2);
    }
    
    .report_detail__back_to_list_btn:active {
        transform: translateY(0);
        box-shadow: 0 4px 6px rgba(37, 99, 235, 0.2);
    }
    
    /* ========================================================================
       ERROR & LOADING STATES
       ======================================================================== */
    
    .report_detail__error,
    .report_detail__loading {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        text-align: center;
        padding: 3rem 1rem;
        min-height: 400px;
        background-color: #FFFFFF;
        border-radius: 12px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }
    
    .report_detail__error_icon {
        width: 64px;
        height: 64px;
        margin-bottom: 1.5rem;
        color: #DC2626;
    }
    
    .report_detail__error_title {
        font-size: 1.5rem;
        font-weight: 700;
        color: #111827;
        margin: 0 0 1rem 0;
    }
    
    .report_detail__error_message {
        font-size: 0.875rem;
        color: #374151;
        margin: 0 0 2rem 0;
        max-width: 500px;
    }
    
    .report_detail__loading_spinner {
        width: 48px;
        height: 48px;
        border: 4px solid #E5E7EB;
        border-top-color: #2563EB;
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
        margin-bottom: 1rem;
    }
    
    .report_detail__loading_text {
        font-size: 0.875rem;
        color: #6B7280;
        margin: 0;
    }
    
    @@keyframes spin {
        to {
            transform: rotate(360deg);
        }
    }
</style>

<!-- ========================================================================
     REPORT DETAIL PAGE
======================================================================== -->

<div class="report_detail">
    @if (!string.IsNullOrEmpty(Model.ErrorMessage))
    {
        <!-- Error State -->
        <div class="report_detail__error">
            <div class="report_detail__error_icon">
                <svg width="64" height="64" viewBox="0 0 64 64" fill="none">
                    <path d="M32 24V32M32 40H32.04M56 32C56 45.2548 45.2548 56 32 56C18.7452 56 8 45.2548 8 32C8 18.7452 18.7452 8 32 8C45.2548 8 56 18.7452 56 32Z" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </div>
            <h3 class="report_detail__error_title">Rapor Yüklenemedi</h3>
            <div class="report_detail__error_message" style="white-space: pre-wrap; word-wrap: break-word; max-width: 100%; overflow-x: auto;">
                @Model.ErrorMessage
            </div>
            <p class="report_detail__error_hint" style="font-size: 0.875rem; color: #6B7280; margin-top: 1rem;">
                Lütfen tarayıcı konsolunu (F12) açarak detaylı hata mesajlarını kontrol edin.
            </p>
            <a asp-page="/Dashboard/Index" class="btn_primary" style="margin-top: 1.5rem;">Dashboard'a Geri Dön</a>
        </div>
    }
    else if (Model.ReportDetail == null)
    {
        <!-- Loading State -->
        <div class="report_detail__loading">
            <div class="report_detail__loading_spinner"></div>
            <p class="report_detail__loading_text">Rapor yükleniyor...</p>
        </div>
    }
    else
    {
        <!-- Report Content -->
        <!-- Header Section -->
        <div class="report_detail__header">
            <div class="report_detail__header_content">
                <a asp-page="/Dashboard/Index" class="report_detail__back_btn">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <path d="M12.5 15L7.5 10L12.5 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span>Geri Dön</span>
                </a>
                <h1 class="report_detail__title">Kredi Değerlendirme Raporu</h1>
                <p class="report_detail__date">Rapor No: @Model.ReportDetail.DisplayReportNumber | Tarih: @DateTime.Now.ToString("dd MMMM yyyy", new System.Globalization.CultureInfo("tr-TR"))</p>
            </div>
        </div>

        <!-- Summary Cards Section (3 Cards - Grid) -->
        <div class="report_detail__summary_cards">
            <!-- Card 1: Kredi Notu (Koyu Mavi - Vurgulu) -->
            @if (Model.ReportDetail.CreditScore.HasValue)
            {
                <div class="report_detail__summary_card report_detail__summary_card--hero">
                    <div class="report_detail__summary_card_content">
                        <div class="report_detail__summary_card_label">KKB Kredi Notunuz</div>
                        <div class="report_detail__summary_card_value--hero">@Model.ReportDetail.CreditScore</div>
                        <!-- Progress Bar -->
                        <div class="report_detail__progress_bar">
                            <div class="report_detail__progress_bar_fill"></div>
                        </div>
                        <div class="report_detail__summary_card_badge">
                            Risk Grubu: @Model.ReportDetail.RiskGroup
                        </div>
                    </div>
                </div>
            }

            <!-- Card 2: Toplam Limit (Beyaz, İkonlu) -->
            @if (Model.ReportDetail.Limit.HasValue)
            {
                <div class="report_detail__summary_card">
                    <div class="report_detail__summary_card_content">
                        <div class="report_detail__summary_card_icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="8" width="18" height="12" rx="2"/>
                                <path d="M3 10c0-2 2-4 5-4h8c3 0 5 2 5 4"/>
                                <path d="M12 14v4M8 16h8"/>
                            </svg>
                        </div>
                        <div class="report_detail__summary_card_label">Toplam Limit</div>
                        <div class="report_detail__summary_card_value--large">@Model.ReportDetail.Limit.Value.ToString("N0", new System.Globalization.CultureInfo("tr-TR")) TL</div>
                    </div>
                </div>
            }

            <!-- Card 3: Toplam Borç (Beyaz, İkonlu) -->
            @if (Model.ReportDetail.Risk.HasValue)
            {
                <div class="report_detail__summary_card">
                    <div class="report_detail__summary_card_content">
                        <div class="report_detail__summary_card_icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
                            </svg>
                        </div>
                        <div class="report_detail__summary_card_label">Toplam Güncel Borç</div>
                        <div class="report_detail__summary_card_value--large">@Model.ReportDetail.Risk.Value.ToString("N0", new System.Globalization.CultureInfo("tr-TR")) TL</div>
                    </div>
                </div>
            }
        </div>

        <!-- Details Table Section -->
        @if (Model.ReportDetail.BireyselDetails != null && Model.ReportDetail.BireyselDetails.Any())
        {
            <div class="report_detail__table_wrapper">
                <div class="report_detail__table_header_section">
                    <h2 class="report_detail__table_title">Aktif Hesap Detayları</h2>
                </div>
                <div class="report_detail__table_container">
                    <table class="report_detail__table">
                        <thead class="report_detail__table_head">
                            <tr class="report_detail__table_row">
                                <th class="report_detail__table_header">Banka</th>
                                <th class="report_detail__table_header">Tür</th>
                                <th class="report_detail__table_header report_detail__table_header--right">Limit</th>
                                <th class="report_detail__table_header report_detail__table_header--right">Borç</th>
                                <th class="report_detail__table_header">Durum</th>
                            </tr>
                        </thead>
                        <tbody class="report_detail__table_body">
                            @foreach (var detail in Model.ReportDetail.BireyselDetails)
                            {
                                <tr class="report_detail__table_row">
                                    <td class="report_detail__table_cell report_detail__table_cell--bank">
                                        @(!string.IsNullOrEmpty(detail.BkKurumRumuzuKarsiligi) ? detail.BkKurumRumuzuKarsiligi : detail.BkKurumRumuzu)
                                    </td>
                                    <td class="report_detail__table_cell">
                                        @detail.BkKrediTuru
                                    </td>
                                    <td class="report_detail__table_cell report_detail__table_cell--numeric">
                                        @if (decimal.TryParse(detail.BkKrediTutariLimiti, out var limit))
                                        {
                                            <span class="report_detail__table_number">@limit.ToString("N0", new System.Globalization.CultureInfo("tr-TR"))</span> <span class="report_detail__table_currency">TL</span>
                                        }
                                        else
                                        {
                                            @detail.BkKrediTutariLimiti
                                        }
                                    </td>
                                    <td class="report_detail__table_cell report_detail__table_cell--numeric">
                                        @if (decimal.TryParse(detail.BkToplamBakiye, out var bakiye))
                                        {
                                            <span class="report_detail__table_number">@bakiye.ToString("N0", new System.Globalization.CultureInfo("tr-TR"))</span> <span class="report_detail__table_currency">TL</span>
                                        }
                                        else
                                        {
                                            @detail.BkToplamBakiye
                                        }
                                    </td>
                                    <td class="report_detail__table_cell">
                                        <span class="report_detail__table_badge">@(!string.IsNullOrEmpty(detail.BkOdemePerformansiTarihcesi) ? detail.BkOdemePerformansiTarihcesi : "-")</span>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        }

        <!-- Back to List Button -->
        <div class="report_detail__actions">
            <a asp-page="/Dashboard/Index" class="report_detail__back_to_list_btn">
                Listeye Dön
            </a>
        </div>
    }
</div>

